/*
BitsJS
Copyright 2014 Sourcebits www.sourcebits.com
Version: 1.0.0
*/
!function(e){var t=function(e){if("function"==typeof e)document.addEventListener("DOMContentLoaded",function(){return e.call(e)});else{if("string"==typeof e)return document.querySelector(e);if(1===e.nodeType)return e}};e.$=t}(this),$.extend=function(e,t,n){return n=n||!1,t||"object"!=typeof e||(t=e,e=$),Object.keys(t).forEach(function(r){t.hasOwnProperty(r)&&Object.defineProperty(e,r,{value:t[r],writable:!0,enumerable:n,configurable:!0})}),this},function(e){$.extend({$$:function(e,t){return e?t&&"string"==typeof t?[].slice.apply($(t).querySelectorAll(e)):t&&3===t.nodeType?[].slice.apply(t.querySelectorAll(e)):"string"==typeof e?[].slice.apply(document.querySelectorAll(e)):e&&3===e.nodeType?e:void 0:void 0}}),e.$$=$.$$}(this),function(e){var t=function(){this.dependencies=[],this.run=function(e){var t=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,n=e.toString();console.log(n.match(t));var r=n.match(t)[1].split(",");r=r.map(function(e){return e.trim()}),e.apply(e,this.get(r))},this.injectInto=function(e){return this.run(e)},this.get=function(e){var t=this;return e.map(function(e){return t.dependencies[e]})},this.map=function(e,t){this.dependencies[e]=t}};e.Injector=t}(this),$.extend({UuidBit:1,Uuid:function(){return this.UuidBit++,Date.now().toString(36)+this.UuidBit},subscriptions:{},subscribe:function(e,t){$.subscriptions[e]||($.subscriptions[e]=[]);var n=$.Uuid();return $.subscriptions[e].push({token:n,callback:t}),n},unsubscribe:function(e){setTimeout(function(){for(var t in $.subscriptions)if($.subscriptions[t])for(var n=0,r=$.subscriptions[t].length;r>n;n++)if($.subscriptions[t][n].token===e)return $.subscriptions[t].splice(n,1),e;return!1})},publish:function(e,t){return $.subscriptions[e]?(setTimeout(function(){for(var n=$.subscriptions[e]?$.subscriptions[e].length:0;n--;)$.subscriptions[e][n].callback(e,t);return!0}),!0):!1}}),$.extend($,{bindData:function(){var e=$$("[data-controller]"),t=[],n=function(e){var n="data-binding-"+$(e).getAttribute("data-controller");t.push(n)};e.forEach(function(e,r){var o=e.getAttribute("data-controller");n(e),$.subscribe(t[r],function(e,t){var n="[data-model="+o+"]";$(n).innerText=t})}),$.on($("body"),"[data-controller]","input",function(){var e="data-binding-"+this.getAttribute("data-controller");$.publish(e,this.value)})}}),$.extend({templates:{},template:function(e,t){var n;t=t||"data",n=/\[\[=([\s\S]+?)\]\]/g;var r=new Function(t,"var p=[];p.push('"+e.replace(/[\r\t\n]/g," ").split("'").join("\\'").replace(n,"',$1,'").split("[[").join("');").split("]]").join("p.push('")+"');return p.join('');");return r}}),function(){function e(e,t){p.add(e,t),l||(l=setTimeout(p.unshift))}function t(e){var t,n=typeof e;return null===e||"object"!==n&&"function"!==n||(t=e.then),"function"==typeof t?t:!1}function n(){for(var e=0;e<this.chain.length;e++)r(this,1===this.state?this.chain[e].success:this.chain[e].failure,this.chain[e]);this.chain.length=0}function r(e,n,r){var o,i;try{n===!1?r.reject(e.msg):(o=n===!0?e.msg:n.call(void 0,e.msg),o===r.promise?r.reject(new TypeError("Promise-chain cycle")):(i=t(o))?i.call(o,r.resolve,r.reject):r.resolve(o))}catch(a){r.reject(a)}}function o(r){var a,s,u=this;if(!u.triggered){u.triggered=!0,u.deferred&&(u=u.deferred);try{(a=t(r))?(s=new c(u),a.call(r,function(){o.apply(s,arguments)},function(){i.apply(s,arguments)})):(u.msg=r,u.state=1,u.chain.length>0&&e(n,u))}catch(f){i.call(s||new c(u),f)}}}function i(t){var r=this;r.triggered||(r.triggered=!0,r.deferred&&(r=r.deferred),r.msg=t,r.state=2,r.chain.length>0&&e(n,r))}function a(e,t,n,r){for(var o=0;o<t.length;o++)!function(o){e.resolve(t[o]).then(function(e){n(o,e)},r)}(o)}function c(e){this.deferred=e,this.triggered=!1}function s(e){this.promise=e,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function u(t){if("function"!=typeof t)throw new TypeError("Not a function");if(0!==this.isValidPromise)throw new TypeError("Not a promise");this.isValidPromise=1;var r=new s(this);this.then=function(t,o){var i={success:"function"==typeof t?t:!0,failure:"function"==typeof o?o:!1};return i.promise=new this.constructor(function(e,t){if("function"!=typeof e||"function"!=typeof t)throw new TypeError("Not a function");i.resolve=e,i.reject=t}),r.chain.push(i),0!==r.state&&e(n,r),i.promise},this["catch"]=function(e){return this.then(void 0,e)};try{t.call(void 0,function(e){o.call(r,e)},function(e){i.call(r,e)})}catch(a){i.call(r,a)}}var f,l,p;f=function(e,t,n,r){return Object.defineProperty(e,t,{value:n,writable:!0,configurable:r!==!1})},p=function(){function e(e,t){this.fn=e,this.self=t,this.next=void 0}var t,n,r;return{add:function(o,i){r=new e(o,i),n?n.next=r:t=r,n=r,r=void 0},unshift:function(){var e=t;for(t=n=l=void 0;e;)e.fn.call(e.self),e=e.next}}}();var d=f({},"constructor",u,!1);return f(u,"prototype",d,!1),f(d,"isValidPromise",0,!1),f(u,"resolve",function(e){var t=this;return e&&"object"==typeof e&&1===e.isValidPromise?e:new t(function(t,n){if("function"!=typeof t||"function"!=typeof n)throw new TypeError("Not a function");t(e)})}),f(u,"reject",function(e){return new this(function(t,n){if("function"!=typeof t||"function"!=typeof n)throw new TypeError("Not a function");n(e)})}),f(u,"all",function(e){var t=this;return"[object Array]"!==Object.prototype.toString.call(e)?t.reject(new TypeError("Not an array")):0===e.length?t.resolve([]):new t(function(n,r){if("function"!=typeof n||"function"!=typeof r)throw new TypeError("Not a function");var o=e.length,i=new Array(o),c=0;a(t,e,function(e,t){i[e]=t,++c===o&&n(i)},r)})}),f(u,"race",function(e){var t=this;return"[object Array]"!==Object.prototype.toString.call(e)?t.reject(new TypeError("Not an array")):new t(function(n,r){if("function"!=typeof n||"function"!=typeof r)throw new TypeError("Not a function");a(t,e,function(e,t){n(t)},r)})}),"Promise"in window&&"resolve"in window.Promise&&"reject"in window.Promise&&"all"in window.Promise&&"race"in window.Promise?void 0:window.Promise=u}(),$.extend($,{ajax:function(e){if(!e)throw"No options where provided to xhr request.";if("object"!=typeof e)throw"Expected an object as argument for options, received something else.";var t,n={type:"GET",beforeSend:$.noop,success:$.noop,error:$.noop,context:null,async:!0,timeout:0,data:null};e.data&&(e.data=encodeURIComponent(e.data)),$.extend(n,e);var r={script:"text/javascript, application/javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"};return new Promise(function(e,o){var i=new XMLHttpRequest,a=n.type,c=n.async,s=n.data;if(i.queryString=s,i.timeout=n.timeout?n.timeout:0,i.open(a,n.url,c),n.headers)for(var u in n.headers)n.headers.hasOwnProperty(u)&&i.setRequestHeader(u,n.headers[u]);n.dataType&&i.setRequestHeader("Content-Type",r[n.dataType]),t=/^([\w-]+:)\/\//.test(n.url)?RegExp.$1:window.location.protocol,i.onload=function(){200===i.status&&i.status<300&&4===i.readyState||304===i.status&&4===i.readyState||0===i.status&&"file:"===t?e(i.response):o(new Error(i.statusText))},i.onerror=function(){o(new Error("There was a network error."))},c?(n.beforeSend!==$.noop&&n.beforeSend(i,n),i.send(s)):n.beforeSend!==$.noop&&n.beforeSend(i,n)})}}),$.extend($,{get:function(e,t,n,r){return e?t?(r||(r=null),"function"!=typeof t||n?"string"==typeof t&&"function"==typeof n?$.ajax({url:e,type:"GET",data:t,success:n,dataType:r}):void 0:$.ajax({url:e,type:"GET",success:t})):$.ajax({url:e,type:"GET"}):void 0},getJSON:function(e,t,n){return e&&t?"function"!=typeof t||n?"string"==typeof t&&"function"==typeof n?$.ajax({url:e,type:"GET",data:t,success:n,dataType:"json"}):void 0:$.ajax({url:e,type:"GET",async:!0,success:t,dataType:"json"}):void 0},JSONP:function(e){var t={url:null,callback:$.noop,callbackType:"callback=?",timeout:null};$.extend(t,e);var n="fn_"+$.uuidNum(),r=document.createElement("script"),o=$("head")[0];r.setAttribute("id",n);var i=new Date;window[n]=function(e){o.removeChild(r),t.callback(e),deferred.resolve(e,"resolved",t),delete window[n]};var a=t.callbackType.substr(0,t.callbackType.length-1);if(r.src=t.url.replace(t.callbackType,a+n),o.appendChild(r),t.timeout){setTimeout(function(){new Date-i>0&&(deferred.reject("timedout",t),t.callback=$.noop)},t.timeout)}return new Promise(function(e,n){var r="fn_"+$.uuidNum(),o=document.createElement("script"),i=$("head")[0];o.setAttribute("id",r);var a=new Date;window[r]=function(n){i.removeChild(o),t.callback(n),e(n),delete window[r]};var c=t.callbackType.substr(0,t.callbackType.length-1);if(o.src=t.url.replace(t.callbackType,c+r),i.appendChild(o),t.timeout){setTimeout(function(){new Date-a>0&&(n("The request timedout."),t.callback=$.noop)},t.timeout)}})},post:function(e,t,n,r){return e&&t?r||"function"==typeof n?"function"!=typeof t||r?"string"==typeof t&&"function"==typeof n?(r||(r="form"),$.ajax({url:e,type:"POST",data:t,success:n,dataType:r})):void 0:(r="string"==typeof n?n:"form",$.ajax({url:e,type:"POST",success:t,dataType:r})):$.ajax({url:e,type:"POST",data:t,dataType:n}):void 0}}),$.extend({camelize:function(e){return"string"==typeof e?e.replace(/\-(.)/g,function(e,t){return t.toUpperCase()}):void 0},deCamelize:function(e){return"string"==typeof e?e.replace(/([A-Z])/g,"-$1").toLowerCase():void 0},getStyle:function(e,t){return e&&t?document.defaultView.getComputedStyle(e,null).getPropertyValue(t.toLowerCase()):void 0},setStyle:function(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e.style[$.camelize(n)]=t[n])},prepend:function(e,t){e&&1!==!e.nodeName&&("string"==typeof t?$(e).insertAdjacentHTML("afterBegin",t):t&&1===t.nodeType&&$(e).insertAdjacentElement("afterBegin",t))},append:function(e,t){e&&1!==!e.nodeName&&("string"==typeof t?$(e).insertAdjacentHTML("beforeEnd",t):t&&1===t.nodeType&&$(e).insertAdjacentElement("beforeEnd",t))},before:function(e,t){e&&1!==!e.nodeName&&("string"==typeof t?$(e).insertAdjacentHTML("beforeBegin",t):t&&1===t.nodeType&&$(e).insertAdjacentElement("beforeBegin",t))},after:function(e,t){e&&1!==!e.nodeName&&("string"==typeof t?$(e).insertAdjacentHTML("afterEnd",t):t&&1===t.nodeType&&$(e).insertAdjacentElement("afterEnd",t))},make:function(e){var t=document.createElement("div");return t.innerHTML=e,1===t.childNodes.length?t.firstElementChild:Array.prototype.slice.call(t.childNodes)},ancestor:function(e,t){if("undefined"==typeof t)return!1;var n=$(e),r=(new RegExp("^#"),new RegExp("^."),null),o=null,i=n.parentNode;if(!i)return!1;if("string"==typeof t&&t.trim(),"number"==typeof t){r=t||1;for(var a=1;r>a;a++){if("HTML"===i.nodeName)return i;null!==i&&(i=i.parentNode)}return i}return"."===t.substr(0,1)?(o=t.split(".")[1],"BODY"===i.nodeName?!1:i.hasClass(o)?i:$.ancestor(i,t)):"#"===t.substr(0,1)?(o=t.split("#")[1],i.getAttribute("id")===o?i:$.ancestor(i,t)):i.tagName.toLowerCase()===t?i:$.ancestor(i,t)}}),$.extend({trigger:function(e,t,n){var r=document.createEvent("Events");r.initEvent(t,!0,!1),n&&(r.data=n),e.dispatchEvent(r)},on:function(e,t,n,r,o){if(o=o||!1,!n&&/Object/gim.test(t.constructor.toString()))for(var i in t)t.hasOwnProperty(i)&&$.on(e,i,t[i]);var a,c=function(e,t,n,r){return r=r||!1,e.addEventListener(t,n,r)},s=function(e,t,n,r,o){o=o||!1,a=function(n){var o=n.target;3===n.target.nodeType&&(o=n.target.parentNode),$$(t,e).forEach(function(e){if(e===o)r.call(e,n);else try{var i=$.ancestor(o,t);e===i[0]&&r.call(e,n)}catch(a){}})},$(e).addEventListener(n,a,o)};return $.subscribe("remove-delegate",function(e,t){$(t.elem).removeEventListener(t.event,a,t.capturePhase)}),"string"==typeof t&&(t=t.trim(),/\s/.test(t)&&(events=t.split(" "),events.length&&events.forEach(function(t){"function"==typeof n?c(e,t,n,r):s(e,n,t,r,o)}))),"function"==typeof n?c(e,t,n,o):s(e,t,n,r,o),e},off:function(e,t,n,r,o){return"function"==typeof n?(o=r||!1,$(e).removeEventListener(t,n,o),$(e)):(o=o||!1,$.publish("remove-delegate",{elem:e,event:n,capturePhase:o}),$(e))}});