/*
BitsJS
Copyright 2014 Sourcebits www.sourcebits.com
Version: 1.0.1
*/
!function(exports){var $=function(selector){if("function"==typeof selector)document.addEventListener("DOMContentLoaded",function(){return selector.call(selector)});else{if("string"==typeof selector)return document.querySelector(selector);if(1===selector.nodeType)return selector}};exports.$=$}(this),$.extend=function(obj,prop,enumerable){return enumerable=enumerable||!1,prop||"object"!=typeof obj||(prop=obj,obj=$),Object.keys(prop).forEach(function(p){prop.hasOwnProperty(p)&&Object.defineProperty(obj,p,{value:prop[p],writable:!0,enumerable:enumerable,configurable:!0})}),this},function(exports){$.extend({$$:function(selector,context){return selector?context&&"string"==typeof context?[].slice.apply($(context).querySelectorAll(selector)):context&&3===context.nodeType?[].slice.apply(context.querySelectorAll(selector)):"string"==typeof selector?[].slice.apply(document.querySelectorAll(selector)):selector&&3===selector.nodeType?selector:void 0:void 0}}),exports.$$=$.$$}(this),function(exports){var Injector=function(){this.dependencies=[],this.run=function(fn){var FN_ARGS=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,FN_STRING=fn.toString();console.log(FN_STRING.match(FN_ARGS));var args=FN_STRING.match(FN_ARGS)[1].split(",");args=args.map(function(value){return value.trim()}),fn.apply(fn,this.get(args))},this.injectInto=function(fn){return this.run(fn)},this.get=function(arr){var self=this;return arr.map(function(value){return self.dependencies[value]})},this.map=function(name,dependency){this.dependencies[name]=dependency}};exports.Injector=Injector}(this),$.extend({UuidBit:1,Uuid:function(){return this.UuidBit++,Date.now().toString(36)+this.UuidBit},subscriptions:{},subscribe:function(topic,callback){$.subscriptions[topic]||($.subscriptions[topic]=[]);var token=$.Uuid();return $.subscriptions[topic].push({token:token,callback:callback}),token},unsubscribe:function(token){setTimeout(function(){for(var m in $.subscriptions)if($.subscriptions[m])for(var i=0,len=$.subscriptions[m].length;len>i;i++)if($.subscriptions[m][i].token===token)return $.subscriptions[m].splice(i,1),token;return!1})},publish:function(topic,args){return $.subscriptions[topic]?(setTimeout(function(){for(var len=$.subscriptions[topic]?$.subscriptions[topic].length:0;len--;)$.subscriptions[topic][len].callback(topic,args);return!0}),!0):!1}}),$.extend($,{bindData:function(){var controllers=$$("[data-controller]"),broadcasts=[],createBroadcaster=function(controller){var broadcast="data-binding-"+$(controller).getAttribute("data-controller");broadcasts.push(broadcast)};controllers.forEach(function(ctx,idx){var model=ctx.getAttribute("data-controller");createBroadcaster(ctx),$.subscribe(broadcasts[idx],function(event,value){var element="[data-model="+model+"]";$(element).innerText=value})}),$.on($("body"),"[data-controller]","input",function(){var broadcast="data-binding-"+this.getAttribute("data-controller");$.publish(broadcast,this.value)})}}),$.extend({templates:{},template:function(tmpl,variable){var regex;variable=variable||"data",regex=/\[\[=([\s\S]+?)\]\]/g;var template=new Function(variable,"var p=[];p.push('"+tmpl.replace(/[\r\t\n]/g," ").split("'").join("\\'").replace(regex,"',$1,'").split("[[").join("');").split("]]").join("p.push('")+"');return p.join('');");return template}}),function(){function schedule(fn,self){queue.add(fn,self),cycle||(cycle=setTimeout(queue.unshift))}function isThenable(obj){var _then,obj_type=typeof obj;return null===obj||"object"!==obj_type&&"function"!==obj_type||(_then=obj.then),"function"==typeof _then?_then:!1}function notify(){for(var i=0;i<this.chain.length;i++)notifyIsolated(this,1===this.state?this.chain[i].success:this.chain[i].failure,this.chain[i]);this.chain.length=0}function notifyIsolated(self,callback,chain){var ret,_then;try{callback===!1?chain.reject(self.msg):(ret=callback===!0?self.msg:callback.call(void 0,self.msg),ret===chain.promise?chain.reject(new TypeError("Promise-chain cycle")):(_then=isThenable(ret))?_then.call(ret,chain.resolve,chain.reject):chain.resolve(ret))}catch(err){chain.reject(err)}}function resolve(msg){var _then,deferred,self=this;if(!self.triggered){self.triggered=!0,self.deferred&&(self=self.deferred);try{(_then=isThenable(msg))?(deferred=new MakeDeferred(self),_then.call(msg,function(){resolve.apply(deferred,arguments)},function(){reject.apply(deferred,arguments)})):(self.msg=msg,self.state=1,self.chain.length>0&&schedule(notify,self))}catch(err){reject.call(deferred||new MakeDeferred(self),err)}}}function reject(msg){var self=this;self.triggered||(self.triggered=!0,self.deferred&&(self=self.deferred),self.msg=msg,self.state=2,self.chain.length>0&&schedule(notify,self))}function iteratePromises(Constructor,arr,resolver,rejecter){for(var idx=0;idx<arr.length;idx++)!function(idx){Constructor.resolve(arr[idx]).then(function(msg){resolver(idx,msg)},rejecter)}(idx)}function MakeDeferred(self){this.deferred=self,this.triggered=!1}function Deferred(self){this.promise=self,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function Promise(executor){if("function"!=typeof executor)throw new TypeError("Not a function");if(0!==this.isValidPromise)throw new TypeError("Not a promise");this.isValidPromise=1;var deferred=new Deferred(this);this.then=function(success,failure){var obj={success:"function"==typeof success?success:!0,failure:"function"==typeof failure?failure:!1};return obj.promise=new this.constructor(function(resolve,reject){if("function"!=typeof resolve||"function"!=typeof reject)throw new TypeError("Not a function");obj.resolve=resolve,obj.reject=reject}),deferred.chain.push(obj),0!==deferred.state&&schedule(notify,deferred),obj.promise},this["catch"]=function(failure){return this.then(void 0,failure)};try{executor.call(void 0,function(msg){resolve.call(deferred,msg)},function(msg){reject.call(deferred,msg)})}catch(err){reject.call(deferred,err)}}var extend,cycle,queue;extend=function(obj,name,val,config){return Object.defineProperty(obj,name,{value:val,writable:!0,configurable:config!==!1})},queue=function(){function Item(fn,self){this.fn=fn,this.self=self,this.next=void 0}var first,last,item;return{add:function(fn,self){item=new Item(fn,self),last?last.next=item:first=item,last=item,item=void 0},unshift:function(){var f=first;for(first=last=cycle=void 0;f;)f.fn.call(f.self),f=f.next}}}();var PromisePrototype=extend({},"constructor",Promise,!1);return extend(Promise,"prototype",PromisePrototype,!1),extend(PromisePrototype,"isValidPromise",0,!1),extend(Promise,"resolve",function(msg){var Constructor=this;return msg&&"object"==typeof msg&&1===msg.isValidPromise?msg:new Constructor(function(resolve,reject){if("function"!=typeof resolve||"function"!=typeof reject)throw new TypeError("Not a function");resolve(msg)})}),extend(Promise,"reject",function(msg){return new this(function(resolve,reject){if("function"!=typeof resolve||"function"!=typeof reject)throw new TypeError("Not a function");reject(msg)})}),extend(Promise,"all",function(arr){var Constructor=this;return"[object Array]"!==Object.prototype.toString.call(arr)?Constructor.reject(new TypeError("Not an array")):0===arr.length?Constructor.resolve([]):new Constructor(function(resolve,reject){if("function"!=typeof resolve||"function"!=typeof reject)throw new TypeError("Not a function");var len=arr.length,msgs=new Array(len),count=0;iteratePromises(Constructor,arr,function(idx,msg){msgs[idx]=msg,++count===len&&resolve(msgs)},reject)})}),extend(Promise,"race",function(arr){var Constructor=this;return"[object Array]"!==Object.prototype.toString.call(arr)?Constructor.reject(new TypeError("Not an array")):new Constructor(function(resolve,reject){if("function"!=typeof resolve||"function"!=typeof reject)throw new TypeError("Not a function");iteratePromises(Constructor,arr,function(idx,msg){resolve(msg)},reject)})}),"Promise"in window&&"resolve"in window.Promise&&"reject"in window.Promise&&"all"in window.Promise&&"race"in window.Promise?void 0:window.Promise=Promise}(),$.extend($,{ajax:function(options){if(!options)throw"No options where provided to xhr request.";if("object"!=typeof options)throw"Expected an object as argument for options, received something else.";var protocol,settings={type:"GET",beforeSend:$.noop,success:$.noop,error:$.noop,context:null,async:!0,timeout:0,data:null};options.data&&(options.data=encodeURIComponent(options.data)),$.extend(settings,options);var dataTypes={script:"text/javascript, application/javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"};return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest,type=settings.type,async=settings.async,params=settings.data;if(xhr.queryString=params,xhr.timeout=settings.timeout?settings.timeout:0,xhr.open(type,settings.url,async),settings.headers)for(var prop in settings.headers)settings.headers.hasOwnProperty(prop)&&xhr.setRequestHeader(prop,settings.headers[prop]);settings.dataType&&xhr.setRequestHeader("Content-Type",dataTypes[settings.dataType]),protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr.onload=function(){200===xhr.status&&xhr.status<300&&4===xhr.readyState||304===xhr.status&&4===xhr.readyState||0===xhr.status&&"file:"===protocol?resolve(xhr.response):reject(new Error(xhr.statusText))},xhr.onerror=function(){reject(new Error("There was a network error."))},async?(settings.beforeSend!==$.noop&&settings.beforeSend(xhr,settings),xhr.send(params)):settings.beforeSend!==$.noop&&settings.beforeSend(xhr,settings)})}}),$.extend($,{get:function(url,data,success,dataType){return url?data?(dataType||(dataType=null),"function"!=typeof data||success?"string"==typeof data&&"function"==typeof success?$.ajax({url:url,type:"GET",data:data,success:success,dataType:dataType}):void 0:$.ajax({url:url,type:"GET",success:data})):$.ajax({url:url,type:"GET"}):void 0},getJSON:function(url,data,success){return url&&data?"function"!=typeof data||success?"string"==typeof data&&"function"==typeof success?$.ajax({url:url,type:"GET",data:data,success:success,dataType:"json"}):void 0:$.ajax({url:url,type:"GET",async:!0,success:data,dataType:"json"}):void 0},JSONP:function(options){var settings={url:null,callback:$.noop,callbackType:"callback=?",timeout:null};$.extend(settings,options);var fn="fn_"+$.uuidNum(),script=document.createElement("script"),head=$("head")[0];script.setAttribute("id",fn);var startTimeout=new Date;window[fn]=function(data){head.removeChild(script),settings.callback(data),deferred.resolve(data,"resolved",settings),delete window[fn]};var strippedCallbackStr=settings.callbackType.substr(0,settings.callbackType.length-1);if(script.src=settings.url.replace(settings.callbackType,strippedCallbackStr+fn),head.appendChild(script),settings.timeout){setTimeout(function(){new Date-startTimeout>0&&(deferred.reject("timedout",settings),settings.callback=$.noop)},settings.timeout)}return new Promise(function(resolve,reject){var fn="fn_"+$.uuidNum(),script=document.createElement("script"),head=$("head")[0];script.setAttribute("id",fn);var startTimeout=new Date;window[fn]=function(data){head.removeChild(script),settings.callback(data),resolve(data),delete window[fn]};var strippedCallbackStr=settings.callbackType.substr(0,settings.callbackType.length-1);if(script.src=settings.url.replace(settings.callbackType,strippedCallbackStr+fn),head.appendChild(script),settings.timeout){setTimeout(function(){new Date-startTimeout>0&&(reject("The request timedout."),settings.callback=$.noop)},settings.timeout)}})},post:function(url,data,success,dataType){return url&&data?dataType||"function"==typeof success?"function"!=typeof data||dataType?"string"==typeof data&&"function"==typeof success?(dataType||(dataType="form"),$.ajax({url:url,type:"POST",data:data,success:success,dataType:dataType})):void 0:(dataType="string"==typeof success?success:"form",$.ajax({url:url,type:"POST",success:data,dataType:dataType})):$.ajax({url:url,type:"POST",data:data,dataType:success}):void 0}}),$.extend({camelize:function(string){return"string"==typeof string?string.replace(/\-(.)/g,function(match,letter){return letter.toUpperCase()}):void 0},deCamelize:function(string){return"string"==typeof string?string.replace(/([A-Z])/g,"-$1").toLowerCase():void 0},getStyle:function(element,property){return element&&property?document.defaultView.getComputedStyle(element,null).getPropertyValue(property.toLowerCase()):void 0},setStyle:function(element,style){if(element&&style)for(var key in style)style.hasOwnProperty(key)&&(element.style[$.camelize(key)]=style[key])},prepend:function(element,selector){element&&1!==!element.nodeName&&("string"==typeof selector?$(element).insertAdjacentHTML("afterBegin",selector):selector&&1===selector.nodeType&&$(element).insertAdjacentElement("afterBegin",selector))},append:function(element,selector){element&&1!==!element.nodeName&&("string"==typeof selector?$(element).insertAdjacentHTML("beforeEnd",selector):selector&&1===selector.nodeType&&$(element).insertAdjacentElement("beforeEnd",selector))},before:function(element,selector){element&&1!==!element.nodeName&&("string"==typeof selector?$(element).insertAdjacentHTML("beforeBegin",selector):selector&&1===selector.nodeType&&$(element).insertAdjacentElement("beforeBegin",selector))},after:function(element,selector){element&&1!==!element.nodeName&&("string"==typeof selector?$(element).insertAdjacentHTML("afterEnd",selector):selector&&1===selector.nodeType&&$(element).insertAdjacentElement("afterEnd",selector))},make:function(HTMLString){var temp=document.createElement("div");return temp.innerHTML=HTMLString,1===temp.childNodes.length?temp.firstElementChild:Array.prototype.slice.call(temp.childNodes)},closest:function(elem,selector){if("undefined"==typeof selector)return!1;var $this=$(elem),position=(new RegExp("^#"),new RegExp("^."),null),newSelector=null,p=$this.parentNode;if(!p)return!1;if("string"==typeof selector&&selector.trim(),"number"==typeof selector){position=selector||1;for(var i=1;position>i;i++){if("HTML"===p.nodeName)return p;null!==p&&(p=p.parentNode)}return p}return"."===selector.substr(0,1)?(newSelector=selector.split(".")[1],"BODY"===p.nodeName?!1:p.hasClass(newSelector)?p:$.ancestor(p,selector)):"#"===selector.substr(0,1)?(newSelector=selector.split("#")[1],p.getAttribute("id")===newSelector?p:$.ancestor(p,selector)):p.tagName.toLowerCase()===selector?p:$.ancestor(p,selector)}}),$.extend({trigger:function(elem,event,data){var evtObj=document.createEvent("Events");evtObj.initEvent(event,!0,!1),data&&(evtObj.data=data),elem.dispatchEvent(evtObj)},on:function(elem,event,selector,callback,capturePhase){if(capturePhase=capturePhase||!1,!selector&&/Object/gim.test(event.constructor.toString()))for(var key in event)event.hasOwnProperty(key)&&$.on(elem,key,event[key]);var __delegatedFunction,__bind=function(elem,event,callback,capturePhase){return capturePhase=capturePhase||!1,elem.addEventListener(event,callback,capturePhase)},__delegate=function(elem,selector,event,callback,capturePhase){capturePhase=capturePhase||!1,__delegatedFunction=function(e){var target=e.target;3===e.target.nodeType&&(target=e.target.parentNode),$$(selector,elem).forEach(function(element){if(element===target)callback.call(element,e);else try{var ancestor=$.ancestor(target,selector);element===ancestor[0]&&callback.call(element,e)}catch(err){}})},$(elem).addEventListener(event,__delegatedFunction,capturePhase)};return $.subscribe("remove-delegate",function(e,obj){$(obj.elem).removeEventListener(obj.event,__delegatedFunction,obj.capturePhase)}),"string"==typeof event&&(event=event.trim(),/\s/.test(event)&&(events=event.split(" "),events.length&&events.forEach(function(evt){"function"==typeof selector?__bind(elem,evt,selector,callback):__delegate(elem,selector,evt,callback,capturePhase)}))),"function"==typeof selector?__bind(elem,event,selector,capturePhase):__delegate(elem,event,selector,callback,capturePhase),elem},off:function(elem,event,selector,callback,capturePhase){return"function"==typeof selector?(capturePhase=callback||!1,$(elem).removeEventListener(event,selector,capturePhase),$(elem)):(capturePhase=capturePhase||!1,$.publish("remove-delegate",{elem:elem,event:selector,capturePhase:capturePhase}),$(elem))}}),$.extend($,{domain:function(){return window.location.origin},path:function(){return window.location.path},router:{route:function(path){return $.router.routes.defined.hasOwnProperty(path)?$.router.routes.defined[path]:new $.router.core.route(path)},"default":function(path){$.router.routes.default=path},error:function(fn){$.router.routes.error=fn},history:{pushState:function(state,title,path){$.router.dispatch(path)&&history.pushState(state,title,path)},popState:function(){$.router.dispatch(document.location.pathname)},observe:function(){window.onpopstate=$.router.history.popState}},match:function(path,parameterize){var possible_routes,slice,compare,params={},route=null;for(route in $.router.routes.defined)if(null!==route&&void 0!==route){route=$.router.routes.defined[route],possible_routes=route.parse();for(var j=0;j<possible_routes.length;j++){if(slice=possible_routes[j],compare=path,slice.search(/:/)>0)for(var i=0;i<slice.split("/").length;i++)i<compare.split("/").length&&":"===slice.split("/")[i].charAt(0)&&(params[slice.split("/")[i].replace(/:/,"")]=compare.split("/")[i],compare=compare.replace(compare.split("/")[i],slice.split("/")[i]));if(slice===compare)return parameterize&&(route.params=params),route}}return null},dispatch:function(passed_route){var previous_route,matched_route;if($.router.routes.current!==passed_route){if($.router.routes.previous=$.router.routes.current,$.router.routes.current=passed_route,matched_route=$.router.match(passed_route,!0),$.router.routes.previous&&(previous_route=$.router.match($.router.routes.previous),null!==previous_route&&null!==previous_route._disembark&&previous_route._disembark()),null!==matched_route)return matched_route.execute(),!0;null!==$.router.routes.error&&$.router.routes.error()}},observe:function(){var fn=function(){$.router.dispatch(location.hash)};"onhashchange"in window&&(window.onhashchange=fn),""!==location.hash&&$.router.dispatch(location.hash)},core:{route:function(path){this.path=path,this.action=null,this._beforeBoarding=null,this._disembark=null,this.params={},$.router.routes.defined[path]=this}},routes:{current:null,"default":null,error:null,previous:null,defined:{}}}}),$.router.core.route.prototype={onboard:function(fn){return this.action=fn,this},beforeBoarding:function(fn){return this._beforeBoarding=fn,this},ondisembark:function(fn){return this._disembark=fn,this},parse:function(){for(var text,parts=[],options=[],re=/\(([^}]+?)\)/g;text=re.exec(this.path);)parts.push(text[1]);return options.push(this.path.split("(")[0]),parts.forEach(function(item,idx){options.push(options[idx]+item)}),options},execute:function(){var result,halt_execution=!1;return $.router.routes.defined[this.path].hasOwnProperty("_beforeBoarding")&&$.router.routes.defined[this.path]._beforeBoarding&&(result=$.router.routes.defined[this.path]._beforeBoarding(),result===!1)?void(halt_execution=!0):void(halt_execution||$.router.routes.defined[this.path].action())}},$.route=$.router.route,$.extend($.route,{reroute:function(route){window.location=window.location.host+route}}),$.extend($,{defineRoutes:function(args){args(),$.router.observe()},paths:function(args){args(),$.router.observe()}});